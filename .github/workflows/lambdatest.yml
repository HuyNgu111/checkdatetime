name: ğŸš€ LambdaTest Automation

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:  # Cho phÃ©p cháº¡y thá»§ cÃ´ng
  schedule:
    - cron: '0 0 * * *'  # Cháº¡y hÃ ng ngÃ y lÃºc 00:00 UTC

jobs:
  lambdatest-automation:
    name: ğŸŒ Cross-Browser Testing
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: â˜• Set up JDK 8
      uses: actions/setup-java@v4
      with:
        java-version: '8'
        distribution: 'temurin'
        cache: 'maven'
    
    - name: ğŸ”§ Install dependencies
      run: |
        echo "Installing Selenium and TestNG..."
        mvn clean install -DskipTests -q
    
    - name: ğŸ”¨ Compile test code
      run: |
        echo "Compiling LambdaTest automation tests..."
        mvn compile -q
    
    - name: ğŸš€ Run LambdaTest automation (Single browser)
      env:
        LAMBDATEST_USERNAME: ${{ secrets.LAMBDATEST_USERNAME }}
        LAMBDATEST_ACCESS_KEY: ${{ secrets.LAMBDATEST_ACCESS_KEY }}
      run: |
        echo "Running automation tests on LambdaTest Cloud..."
        echo "Browser: Chrome on Windows 10"
        echo "Dashboard: https://automation.lambdatest.com/timeline"
        mvn exec:java \
          -Dexec.mainClass="selenium.LambdaTestRunner" \
          -Dexec.args="Chrome latest 'Windows 10'"
    
    - name: ğŸ“Š Generate test summary
      if: always()
      run: |
        echo "## ğŸš€ LambdaTest Automation Results" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ğŸŒ Test Configuration" >> $GITHUB_STEP_SUMMARY
        echo "- **Browser:** Chrome (latest)" >> $GITHUB_STEP_SUMMARY
        echo "- **Platform:** Windows 10" >> $GITHUB_STEP_SUMMARY
        echo "- **Resolution:** 1920x1080" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ğŸ“‹ Test Cases" >> $GITHUB_STEP_SUMMARY
        echo "1. âœ… Open website" >> $GITHUB_STEP_SUMMARY
        echo "2. âœ… Verify page title" >> $GITHUB_STEP_SUMMARY
        echo "3. âœ… Test search functionality" >> $GITHUB_STEP_SUMMARY
        echo "4. âœ… Verify search results" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ğŸ¥ Features Enabled" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Video recording" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Screenshots" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Network logs" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Console logs" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ğŸ“Š View Full Results" >> $GITHUB_STEP_SUMMARY
        echo "[LambdaTest Dashboard](https://automation.lambdatest.com/timeline)" >> $GITHUB_STEP_SUMMARY
    
    - name: ğŸ“ Upload test logs
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: lambdatest-logs
        path: |
          target/surefire-reports/
          *.log
        retention-days: 30
    
    - name: âœ… Success notification
      if: success()
      run: |
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘  âœ… LAMBDATEST TESTS PASSED!          â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "View results: https://automation.lambdatest.com/timeline"
    
    - name: âŒ Failure notification
      if: failure()
      run: |
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘  âŒ LAMBDATEST TESTS FAILED!          â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "Check logs above for details"
        echo "View dashboard: https://automation.lambdatest.com/timeline"
